<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>API 命名工具 - 分词器验证</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/build/kuromoji.js"></script>
    <script src="dictionary.js"></script>
    <style>
        body { font-family: sans-serif; padding: 40px; background: #f0f2f5; }
        .card { background: white; padding: 24px; border-radius: 12px; max-width: 600px; margin: 0 auto; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status-box { padding: 10px; border-radius: 6px; margin-bottom: 20px; font-size: 0.9em; }
        .loading { background: #fff3e0; color: #e65100; border: 1px solid #ffeb3b; }
        .ready { background: #e8f5e9; color: #2e7d32; border: 1px solid #a5d6a7; }
        textarea { width: 100%; height: 80px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .token-list { margin-top: 15px; display: flex; flex-wrap: wrap; gap: 8px; }
        .token { background: #eee; padding: 4px 10px; border-radius: 4px; font-size: 0.9em; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <div id="app" class="card">
        <h1>分词引擎测试</h1>
        
        <div :class="['status-box', isReady ? 'ready' : 'loading']">
            {{ isReady ? '✅ 分词引擎已就绪' : '⏳ 正在从 CDN 下载分词字典 (请稍候)...' }}
        </div>

        <textarea v-model="inputText" :disabled="!isReady" placeholder="请输入日语（如：住所一覧）..."></textarea>
        
        <div v-if="tokens.length > 0">
            <p><strong>分词结果（原文）：</strong></p>
            <div class="token-list">
                <span v-for="(t, i) in tokens" :key="i" class="token">{{ t }}</span>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted, watch } = Vue;

        createApp({
            setup() {
                const inputText = ref('');
                const isReady = ref(false);
                const tokenizer = ref(null);
                const tokens = ref([]);

                onMounted(() => {
                    // 确保使用稳定的 HTTPS CDN 地址
                    const DIC_URL = "https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dict/";
                    
                    kuromoji.builder({ dicPath: DIC_URL }).build((err, _tokenizer) => {
                        if (err) {
                            console.error("引擎加载失败:", err);
                            return;
                        }
                        tokenizer.value = _tokenizer;
                        isReady.value = true;
                    });
                });

                // 监听输入并执行分词
                watch(inputText, (newVal) => {
                    if (tokenizer.value && newVal.trim()) {
                        const result = tokenizer.value.tokenize(newVal.trim());
                        tokens.value = result.map(t => t.surface_form);
                    } else {
                        tokens.value = [];
                    }
                });

                return {
                    inputText,
                    isReady,
                    tokens
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
