<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Kuromoji MVP éªŒè¯å·¥å…·</title>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; color: #333; }
        .box { border: 1px solid #ccc; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .loading { color: #e65100; background: #fff3e0; }
        .ready { color: #2e7d32; background: #e8f5e9; }
        .error { color: #c62828; background: #ffebee; }
        #status { font-weight: bold; padding: 10px; border-radius: 4px; }
        pre { background: #f4f4f4; padding: 10px; overflow-x: auto; font-size: 13px; }
        textarea { width: 100%; height: 60px; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>ğŸ” Kuromoji åŠ è½½éªŒè¯</h1>

    <div id="status" class="box loading">â³ æ­£åœ¨è¿æ¥ CDN å¹¶ä¸‹è½½å­—å…¸ (Step 1/2)...</div>

    <div class="box">
        <h3>æµ‹è¯•åˆ†è¯</h3>
        <p>å¼•æ“å‡†å¤‡å°±ç»ªåï¼Œåœ¨ä¸‹æ–¹è¾“å…¥æ—¥è¯­ï¼š</p>
        <textarea id="input" disabled placeholder="ç­‰å¾…å¼•æ“åŠ è½½..."></textarea>
        <div id="output-container" style="margin-top: 10px;">
            <strong>åˆ†è¯ç»“æœï¼š</strong>
            <pre id="output">å°šæœªè¿è¡Œ</pre>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/build/kuromoji.js"></script>

    <script>
        const statusEl = document.getElementById('status');
        const inputEl = document.getElementById('input');
        const outputEl = document.getElementById('output');

        // 1. éªŒè¯åº“æ˜¯å¦åŠ è½½
        if (typeof kuromoji === 'undefined') {
            statusEl.className = 'box error';
            statusEl.innerText = 'âŒ é”™è¯¯ï¼šæœªèƒ½åŠ è½½ kuromoji.js åº“æ–‡ä»¶ã€‚è¯·æ£€æŸ¥ç½‘ç»œã€‚';
        } else {
            console.log('Kuromoji åº“æ–‡ä»¶å·²åŠ è½½ï¼Œå¼€å§‹æ„å»ºåˆ†è¯å™¨...');
            
            // 2. å°è¯•å¼‚æ­¥æ„å»ºåˆ†è¯å™¨
            // ä½¿ç”¨ HTTPS ç»å¯¹è·¯å¾„
            const DIC_PATH = "https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dict/";

            kuromoji.builder({ dicPath: DIC_PATH }).build((err, tokenizer) => {
                if (err) {
                    statusEl.className = 'box error';
                    statusEl.innerText = 'âŒ å­—å…¸ä¸‹è½½/è§£æå¤±è´¥ï¼š' + err.message;
                    console.error(err);
                    return;
                }

                // 3. æ„å»ºæˆåŠŸ
                statusEl.className = 'box ready';
                statusEl.innerText = 'âœ… å¼•æ“å°±ç»ªï¼å¯ä»¥è¿›è¡Œåˆ†è¯æµ‹è¯•ã€‚';
                inputEl.disabled = false;
                inputEl.placeholder = 'è¾“å…¥æ—¥è¯­ï¼Œä¾‹å¦‚ï¼šå–å¼•å…ˆè²¬ä»»è€…';

                // 4. ç»‘å®šå®æ—¶æµ‹è¯•
                inputEl.addEventListener('input', (e) => {
                    const val = e.target.value.trim();
                    if (!val) {
                        outputEl.innerText = 'ç­‰å¾…è¾“å…¥...';
                        return;
                    }
                    try {
                        const result = tokenizer.tokenize(val);
                        // ä»…æ˜¾ç¤ºåˆ†è¯åçš„è¡¨é¢æ–‡å­—
                        const surfaceForms = result.map(t => t.surface_form).join(' | ');
                        outputEl.innerText = surfaceForms;
                    } catch (ex) {
                        outputEl.innerText = 'åˆ†è¯è¿è¡Œé”™è¯¯ï¼š' + ex.message;
                    }
                });
            });
        }
    </script>
</body>
</html>
