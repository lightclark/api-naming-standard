<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>API å‘½åç»Ÿä¸€å·¥å…·</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/build/kuromoji.js"></script>
    <script src="dictionary.js"></script>
    <style>
        :root { --primary-color: #1a73e8; --success-color: #34a853; --bg-color: #f0f2f5; }
        body { font-family: system-ui, sans-serif; background: var(--bg-color); margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: 1fr 320px; gap: 20px; }
        @media (max-width: 800px) { .container { grid-template-columns: 1fr; } }
        .card { background: white; padding: 24px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        textarea { width: 100%; height: 100px; padding: 15px; border: 2px solid #eee; border-radius: 12px; font-size: 16px; box-sizing: border-box; resize: none; }
        .result-box { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 12px; border-left: 5px solid var(--primary-color); }
        .label { font-size: 11px; color: #888; margin-bottom: 4px; font-weight: bold; }
        .value { font-family: monospace; font-weight: 600; color: #d93025; font-size: 1.2em; word-break: break-all; }
        .token-tag { display: inline-block; background: #fff3e0; color: #e65100; padding: 2px 8px; border-radius: 4px; margin: 0 4px 4px 0; font-size: 13px; border: 1px solid #ffcc80; }
        .status { font-size: 12px; padding: 4px 12px; border-radius: 20px; float: right; }
        .status.loading { background: #fff3e0; color: #e65100; }
        .status.ready { background: #e8f5e9; color: #2e7d32; }
        .btn { border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; }
        .btn-primary { background: var(--primary-color); color: white; margin-top: 10px; }
        .btn-success { background: var(--success-color); color: white; margin-top: 15px; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 10px; box-sizing: border-box; }
    </style>
</head>
<body>
    <div id="app" class="container">
        <div class="card">
            <span :class="['status', isReady ? 'ready' : 'loading']">
                {{ isReady ? 'â— å¼•æ“å°±ç»ª' : 'â— æ­£åœ¨å®‰å…¨åŠ è½½(5så†…è‡ªåŠ¨è§£é”)' }}
            </span>
            <h2>âš™ï¸ API è½¬æ¢å™¨</h2>
            <textarea v-model="input" :placeholder="isReady ? 'è¯·è¾“å…¥æ—¥è¯­å•è¯æˆ–çŸ­è¯­...' : 'æ­£åœ¨å‡†å¤‡ç¯å¢ƒä¸­...'"></textarea>
            
            <div v-if="input">
                <div class="result-box"><div class="label">å°é©¼å³°</div><div class="value">{{ camelResult }}</div></div>
                <div class="result-box"><div class="label">ä¸‹åˆ’çº¿</div><div class="value">{{ snakeResult }}</div></div>
                <div style="margin-top:15px">
                    <div class="label">è¯†åˆ«ç»“æœï¼ˆåŸæ–‡åˆ†è¯ï¼‰</div>
                    <span v-for="t in debugTokens" :key="t" class="token-tag">{{ t }}</span>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>ğŸ“– æœ¬åœ°è¡¥ä¸</h3>
            <input v-model="newJa" placeholder="æ—¥è¯­é•¿è¯">
            <input v-model="newEn" placeholder="è‹±æ–‡ç¿»è¯‘">
            <button class="btn btn-primary" @click="addEntry">æ·»åŠ è¡¥ä¸æ¡ç›®</button>
            
            <div v-if="Object.keys(customDict).length > 0" style="margin-top: 20px; border-top: 1px solid #eee; pt: 15px;">
                <button class="btn btn-success" @click="syncAndClear">ä¸€é”®åŒæ­¥å¹¶æ¸…ç†ç¼“å­˜</button>
                <p style="font-size: 11px; color: #999; margin-top: 8px;">* åŒæ­¥å°†å¤åˆ¶ä»£ç å¹¶è‡ªåŠ¨æ¸…ç©ºè¡¥ä¸åˆ—è¡¨</p>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                const input = ref('');
                const isReady = ref(false);
                const tokenizer = ref(null);
                const newJa = ref('');
                const newEn = ref('');
                const customDict = ref(JSON.parse(localStorage.getItem('api_custom_dict') || '{}'));

                onMounted(() => {
                    // æ ¸å¿ƒé˜²æŠ¤ï¼š5ç§’è¶…æ—¶è‡ªæ•‘ï¼Œé˜²æ­¢ CDN æŒ‚æ‰å¯¼è‡´é¡µé¢æ­»é”
                    const safeUnlock = setTimeout(() => {
                        if (!isReady.value) {
                            isReady.value = true;
                            console.warn("åˆ†è¯å¼•æ“åŠ è½½è¶…æ—¶ï¼Œå·²åˆ‡æ¢è‡³åŸºç¡€æ¨¡å¼ã€‚");
                        }
                    }, 5000);

                    kuromoji.builder({ dicPath: "https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dict/" })
                        .build((err, _tokenizer) => {
                            clearTimeout(safeUnlock);
                            if (!err) {
                                tokenizer.value = _tokenizer;
                                console.log("åˆ†è¯å¼•æ“åŠ è½½æˆåŠŸ");
                            }
                            isReady.value = true;
                        });
                });

                // ç¿»è¯‘é€»è¾‘æ•´åˆ (ä¸å¤–æŒ‚åœ¨ dictionary.js)
                const translateWord = (word) => {
                    const base = typeof BASE_DICT !== 'undefined' ? BASE_DICT : {};
                    return customDict.value[word] || base[word] || word;
                };

                // æ—¥è¯­åŸæ–‡åˆ†è¯ç»“æœ
                const debugTokens = computed(() => {
                    if (!input.value) return [];
                    const text = input.value.trim();
                    const base = typeof BASE_DICT !== 'undefined' ? BASE_DICT : {};
                    if (customDict.value[text] || base[text]) return [text];
                    if (!tokenizer.value) return [text]; // é™çº§æ¨¡å¼ç›´æ¥è¿”å›å…¨æ–‡
                    return tokenizer.value.tokenize(text).map(t => t.surface_form);
                });

                // ç¿»è¯‘åçš„ Token æ•°ç»„
                const processedTokens = computed(() => {
                    return debugTokens.value.map(word => translateWord(word));
                });

                const camelResult = computed(() => {
                    return processedTokens.value.map((w, i) => 
                        i === 0 ? w.toLowerCase() : w.charAt(0).toUpperCase() + w.slice(1).toLowerCase()
                    ).join('');
                });

                const snakeResult = computed(() => processedTokens.value.join('_').toLowerCase());

                const addEntry = () => {
                    if (newJa.value && newEn.value) {
                        customDict.value[newJa.value.trim()] = newEn.value.trim();
                        newJa.value = ''; newEn.value = '';
                        localStorage.setItem('api_custom_dict', JSON.stringify(customDict.value));
                    }
                };

                const syncAndClear = () => {
                    const base = typeof BASE_DICT !== 'undefined' ? BASE_DICT : {};
                    const finalContent = `const BASE_DICT = ${JSON.stringify({ ...base, ...customDict.value }, null, 4)};`;
                    
                    navigator.clipboard.writeText(finalContent).then(() => {
                        // é™é»˜æ¸…ç†ï¼šä¸å¼¹ alertï¼Œç›´æ¥æ¸…ç¼“å­˜å¹¶è·³è½¬
                        localStorage.removeItem('api_custom_dict');
                        const editUrl = "https://github.com/lightclark/api-naming-standard/edit/main/dictionary.js";
                        window.open(editUrl, "_blank");
                        location.reload();
                    });
                };

                return { input, isReady, camelResult, snakeResult, debugTokens, customDict, newJa, newEn, addEntry, syncAndClear };
            }
        }).mount('#app');
    </script>
</body>
</html>
